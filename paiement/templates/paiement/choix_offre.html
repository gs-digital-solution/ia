{% block content %}
<style>
.paiement-section {
    background: #fff9eb;
    border-radius: 14px;
    border: 3px solid #ffa955;
    box-shadow: 0 3px 16px 0 #efba6016;
    max-width: 520px;
    margin: 2.2rem auto 1.4rem auto;
    padding: 2.1rem 1.7rem 2.0rem 1.7rem;
    font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
}
.paiement-header {
    color: #b26d0a;
    font-weight: 800;
    font-size: 2em;
    margin-bottom: 1.1em;
    text-align: center;
    letter-spacing: 0.02em;
}
.form-row-label {
    font-weight: 700;
    color: #008060;
    font-size: 1.06em;
    margin-bottom: .6em;
    margin-top: 1.3em;
    display:block;
}
.paiement-select, .paiement-input {
    width: 100%;
    border: 1.5px solid #ffaa55;
    border-radius: 7px;
    padding: 0.9em 1em;
    margin-bottom: 1.2em;
    background: #fff7e4;
    font-size: 1.08em;
    font-family: inherit;
    transition: border-color 0.2s;
}
.paiement-input:focus, .paiement-select:focus { outline: 2px solid #ffa955; }
.paiement-btn {
    background: #008060;
    color: #fff;
    width: 100%;
    font-weight: 700;
    font-size: 1.2em;
    border: none;
    border-radius: 7px;
    padding: 0.92em 0.3em;
    margin-top: 1.4em;
    margin-bottom: 0.2em;
    cursor:pointer;
    box-shadow: 0 2px 10px #00806015;
    transition: background 0.22s;
}
.paiement-btn:hover { background: #00a484; }
.errormsg {
    background: #ffe1d5;
    color: #c42700;
    border-radius: 9px;
    box-shadow: 0 1px 6px #ef836414;
    padding: 1em 1.7em;
    margin-bottom:1.2em;
    font-weight: 600;
    text-align: center;
}
@media (max-width: 600px) {
    .paiement-section { max-width: 99vw; padding: 1.1rem 0.25rem; }
    .paiement-header { font-size: 1.23em;}
}
</style>

<div class="paiement-section">
    <div class="paiement-header">üí∞ Payer mon abonnement</div>
    {% if error %}
      <div class="errormsg">{{ error }}</div>
    {% endif %}
    <form method="post" autocomplete="off">
        {% csrf_token %}
        <label class="form-row-label">Offre d'abonnement :</label>
        <select name="abonnement_id" class="paiement-select" required>
          {% for offre in offres %}
            <option value="{{ offre.id }}">{{ offre.nom }} ({{ offre.prix_base }} FCFA)</option>
          {% endfor %}
        </select>
        <label class="form-row-label">Pays :</label>
        <select name="pays_code" id="select-pays" class="paiement-select" required>
          {% for pays in pays %}
            <option value="{{ pays.code }}">{{ pays.nom }}</option>
          {% endfor %}
        </select>
        <label class="form-row-label">M√©thode de paiement :</label>
        <select name="method_code" id="select-method" class="paiement-select" required>
          {% for method in methods %}
            <option value="{{ method.code }}" data-pays="{{ method.pays.code }}">
              {{ method.nom_affiche }} ({{ method.operateur }}){% if method.ussd %} ‚Ä¢ {{ method.ussd }}{% endif %}
            </option>
          {% endfor %}
        </select>
        <label class="form-row-label">Num√©ro Mobile Money :</label>
        <input name="phone" type="text" maxlength="15" class="paiement-input" placeholder="Ex: 6XXXXXXXX" required>
        <button type="submit" class="paiement-btn">Payer</button>
    </form>
    <div style="font-size:0.96em;margin-top:1.3em;color:#b26d0a;">
        Apr√®s avoir cliqu√© sur ‚ÄúPayer‚Äù, validez la transaction sur votre t√©l√©phone.
    </div>
</div>
<script>
// Filtrage dynamique des m√©thodes disponibles pour chaque pays
document.addEventListener('DOMContentLoaded', function() {
    var paysSelect = document.getElementById('select-pays');
    var methodSelect = document.getElementById('select-method');
    if(paysSelect && methodSelect) {
        paysSelect.addEventListener('change', function() {
            var v = this.value;
            Array.from(methodSelect.options).forEach(function(opt){
                opt.style.display = (opt.dataset.pays === v) ? '' : 'none';
            });
            var found = Array.from(methodSelect.options).find(opt=>opt.style.display!=='none');
            if(found) methodSelect.value = found.value;
        });
        paysSelect.dispatchEvent(new Event('change'));
    }
});
</script>
{% endblock %}