{% block content %}

<style>
.quick-nav {
    width: 100%;
    max-width: 540px;
    margin: 0 auto 1.1em auto;
    display: flex;
    justify-content: center;
    gap: 1em;
    flex-wrap: wrap;
}
.quick-btn {
    background: #00a484;
    color: #fff;
    font-size: 1.08em;
    font-weight: 600;
    border: none;
    border-radius: 25px;
    padding: 0.44em 1.2em 0.46em 1.2em;
    margin:0;
    box-shadow: 0 1px 6px #00806044;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background .18s, color .18s, box-shadow .2s;
}
.quick-btn:hover, .quick-btn:focus {
    background: #008060;
    color: #efefef;
}
@media (max-width: 700px) {
    .quick-nav { max-width:98vw; gap:0.32em;}
    .quick-btn { width: 95vw; max-width:99vw; text-align:center; margin: 0.09em auto;}
}
</style>
<div class="quick-nav">
    <a href="{% url 'correction:soumettre' %}" class="quick-btn">corriger un sujet avec CIS</a>
    <a href="{% url 'correction:historique' %}" class="quick-btn">Historique</a>
    <a href="{% url 'logout' %}" class="quick-btn">Déconnexion</a>
</div>

<style>
.corrige-section {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    max-width: 540px;
    margin: 2rem auto;
    padding: 1.1rem 1.3rem;
    text-align: center;
}
.corrige-header {
    color: #008060;
    font-weight: 700;
    font-size: 1.5em;
    margin-bottom: 18px;
    text-align: center;
}
.corrige-bloc {
    background: #fff;     /* fond blanc même sur écran */
    border-radius: 7px;
    padding: 0.3em 0.7em 0.4em 0.7em; /* padding réduit */
    margin-bottom: 0.15em; /* espace très réduit */
    color: #111;         /* texte noir pur */
    word-break: break-word;
    display: block;
    text-align: left;
    max-width: 100%;
    font-size: 1.07em;
    white-space: pre-line;
    line-height: 1.07;
    border: 1px solid #f0f0f0;
}
.btn-zone-pdf-noch {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25em;
    margin: 0.7em 0 0.2em 0;
}
a.django-link { color:#008060; text-decoration:underline; }
a.django-link:hover { color: #00a484; }
.btn-retour, #pdfBtn {
    background:#008060;
    color:#fff;
    padding:0.39em 1.12em;
    margin:0;
    border-radius:5px;
    border:none;
    cursor:pointer;
    font-weight:550;
    display: block;
    font-size: 1.03em;
    width: 100%;
    margin-bottom: 0.11em;
    box-sizing: border-box;
}
.btn-retour:hover, #pdfBtn:hover {background:#00a484;}
@media print {
    .btn-retour, #pdfBtn, nav, .navbar, header, footer { display: none !important; }
    body, .corrige-section, .corrige-bloc { background: #fff !important; color: #111 !important; }
    .corrige-section { margin: 0 !important; padding: 0.6em 0.2em !important; box-shadow: none !important; }
    .corrige-header { font-size: 1.14em !important; color: #111 !important; }
    a.django-link { color: #111 !important; text-decoration: underline !important; }
}
</style>
<div class="corrige-section">
    <div class="corrige-header">Corrigé généré</div>
    <div style="margin-bottom:2px;"><b>Date de soumission :</b> {{ demande.date_soumission|date:"d/m/Y H:i" }}</div>
    <div class="corrige-bloc" style="margin-bottom: 0.07em;">
        <b>Fichier de l’énoncé :</b>
        {% if demande.fichier %}
            <a class="django-link" href="{{ demande.fichier.url }}" target="_blank">{{ demande.fichier.name }}</a>
        {% else %}
            Aucun fichier joint.
        {% endif %}
    </div>
    <div class="corrige-bloc" style="margin-top: 0.01em;">
        <b>Corrigé :</b>
        <div id="zone-corrige">{% autoescape off %}{{ demande.corrigé|linebreaksbr }}{% endautoescape %}</div>
    </div>
    <div class="btn-zone-pdf-noch">
        {% if pdf_enabled %}
            <button id="pdfBtn" type="button">Télécharger/Enregistrer en PDF</button>
        {% endif %}
        <a href="{% url 'correction:soumettre' %}" class="btn-retour">← Soumettre un autre exercice</a>
    </div>
</div>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['\\[', '\\]']],
  },
  svg: { fontCache: 'global' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
    var btn = document.getElementById("pdfBtn");
    if(btn){
        btn.addEventListener('click', function(){
            window.print();
        });
        if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
            btn.addEventListener('click', function(){
                setTimeout(function(){
                    alert("Astuce : Sur mobile, après avoir lancé l'impression, choisissez 'Enregistrer en PDF' ou 'Partager', puis consultez le PDF dans Téléchargements/Fichiers.");
                }, 700);
            });
        }
    }
});
</script>

{% endblock %}
