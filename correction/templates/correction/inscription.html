{% block content %}
<style>
body { background: #f9fcf7; }

.quick-nav {
    width: 100%;
    max-width: 540px;
    margin: 0 auto 1.1em auto;
    display: flex;
    justify-content: center;
    gap: 1em;
    flex-wrap: wrap;
}
.quick-btn {
    background: #00a484;
    color: #fff;
    font-size: 1.08em;
    font-weight: 600;
    border: none;
    border-radius: 25px;
    padding: 0.44em 1.2em 0.46em 1.2em;
    margin:0;
    box-shadow: 0 1px 6px #00806044;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background .18s, color .18s, box-shadow .2s;
}
.quick-btn:hover, .quick-btn:focus {
    background: #008060;
    color: #efefef;
}
@media (max-width: 700px) {
    .quick-nav { max-width:98vw; gap:0.32em;}
    .quick-btn { width: 95vw; max-width:99vw; text-align:center; margin: 0.09em auto;}
}

.form-section {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    padding: 2rem 1.5rem;
    max-width: 540px;
    margin: 2.2rem auto;
}
.form-header {
    color: #008060;
    font-weight: 700;
    font-size: 2em;
    letter-spacing: 1px;
    margin-bottom: 1.5rem;
    text-align: center;
}
label {
    color: #008060;
    font-weight: 500;
    margin-top: 1rem;
    display: block;
    margin-bottom: 0.5rem;
}
input[type="text"], input[type="password"], input[type="tel"], input[type="email"], select {
    width: 100%;
    border: 1.5px solid #008060;
    border-radius: 5px;
    padding: 0.6em;
    margin-bottom: 1.2em;
    background: #f6fefb;
    font-size: 1em;
    transition: border-color 0.2s;
}
input:focus, select:focus { border-color: #00a484; outline: none;}
button.submit-btn {
    width: 100%; background: #008060; color: #fff; font-weight: 600; font-size: 1.2em;
    border: none; border-radius: 5px; padding: 0.8em 0.5em; margin-top: 1em; cursor: pointer; transition: background 0.3s;
}
button.submit-btn:hover { background: #00a484; }
.form-hint {
    font-size: .95em; color: #00695f; margin-bottom: 1em; margin-top: -0.5em;
}
@media (max-width: 700px) {
    .form-section { max-width: 99vw; padding: 1.1rem 0.47rem; }
    .form-header { font-size: 1.35em; }
}
.msg-bloc { margin-bottom: 1.07em;}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const paysSelect = document.getElementById('id_pays');
    const ssSelect = document.getElementById('id_sous_systeme');

    function resetSelect(select, placeholder='S√©lectionner...') {
        select.innerHTML = '';
        select.appendChild(new Option(placeholder, ''));
        select.disabled = true;
    }

    function fillSelect(select, dataArray, placeholder='S√©lectionner...') {
        select.innerHTML = '';
        select.appendChild(new Option(placeholder, ''));
        dataArray.forEach(item => {
            select.appendChild(new Option(item.nom, item.id));
        });
        select.disabled = dataArray.length === 0;
    }

    // Au chargement, d√©sactive le select sous-syst√®me si pas de pays choisi
    if (!paysSelect.value) {
        resetSelect(ssSelect, 'S√©lectionner d\'abord un pays');
    }

    paysSelect.addEventListener('change', function() {
        let val = paysSelect.value;
        resetSelect(ssSelect, 'Chargement...');
        if (!val) {
            resetSelect(ssSelect, 'S√©lectionner d\'abord un pays');
            return;
        }
        fetch(`/correction/ajax/sous-systemes/?pays_id=${val}`)
            .then(r => r.json())
            .then(data => fillSelect(ssSelect, data, 'S√©lectionner un sous-syst√®me'));
    });
});
</script>
<div class="quick-nav">
    <a href="{% url 'correction:login' %}" class="quick-btn">Se connecter</a>
    <a href="{% url 'correction:inscription' %}" class="quick-btn">Cr√©er un compte</a>
</div>

<div class="form-section">
    <div class="form-header">üë§ Inscription utilisateur</div>
    {% if messages %}
      <div class="msg-bloc">
        {% for m in messages %}
          <div style="
            background: {% if m.tags == 'success' %}#d2ffe2{% else %}#ffe1e1{% endif %};
            color: {% if m.tags == 'success' %}#007931{% else %}#d10c20{% endif %};
            border-radius:8px; padding:0.72em 1.12em; font-weight:600; text-align:center;">
            {{ m }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
    <form method="post" autocomplete="off">
        {% csrf_token %}
        {% if form.non_field_errors %}
            <div style="background:#ffe1e1; color:#d10c20; border-radius:8px; padding:0.7em 1.1em; font-weight: 600; margin-bottom:0.9em;">
                {{ form.non_field_errors }}
            </div>
        {% endif %}

        <label for="id_first_name">Pr√©nom</label>
        {{ form.first_name }}
        <label for="id_whatsapp_number">Num√©ro WhatsApp</label>
        <span class="form-hint"> </span>
        {{ form.whatsapp_number }}
        <label for="id_pays">Pays</label>
        {{ form.pays }}
        <label for="id_sous_systeme">Sous-syst√®me</label>
        {{ form.sous_systeme }}
        <label for="id_gmail">Adresse Gmail</label>
        {{ form.gmail }}
        <label for="id_password1">Mot de passe</label>
        {{ form.password1 }}
        <label for="id_password2">Confirmer mot de passe</label>
        {{ form.password2 }}
        <label for="id_secret_question">Question secr√®te</label>
        {{ form.secret_question }}
        <label for="id_secret_answer">R√©ponse secr√®te</label>
        {{ form.secret_answer }}

        <button type="submit" class="submit-btn">Cr√©er mon compte</button>
    </form>
    <div style="margin-top:1.1em; text-align:center; font-size:.99em;">
        <a href="{% url 'correction:login' %}" style="color:#00a484;text-decoration:underline;">D√©j√† inscrit ? Se connecter</a>
    </div>
</div>
{% endblock %}